<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <script>
    // 27) Programa una clase llamada Pelicula.

    // La clase recibirá un objeto al momento de instanciarse con los siguentes datos: id de la película en IMDB, titulo, director, año de estreno, país o países de origen, géneros y calificación en IMBD.
    // - Todos los datos del objeto son obligatorios.
    // - Valida que el id IMDB tenga 9 caracteres, los primeros 2 sean letras y los 
    //     7 restantes números.
    // - Valida que el título no rebase los 100 caracteres.
    // - Valida que el director no rebase los 50 caracteres.
    // - Valida que el año de estreno sea un número entero de 4 dígitos.
    // - Valida que el país o paises sea introducidos en forma de arreglo.
    // - Valida que los géneros sean introducidos en forma de arreglo.
    // - Valida que los géneros introducidos esten dentro de los géneros 
    //     aceptados*.
    // - Crea un método estático que devuelva los géneros aceptados*.
    // - Valida que la calificación sea un número entre 0 y 10 pudiendo ser 
    //     decimal de una posición.
    // - Crea un método que devuelva toda la ficha técnica de la película.
    // - Apartir de un arreglo con la información de 3 películas genera 3 
    //     instancias de la clase de forma automatizada e imprime la ficha técnica 
    //     de cada película.

    // * Géneros Aceptados: Action, Adult, Adventure, Animation, Biography, Comedy, Crime, Documentary ,Drama, Family, Fantasy, Film Noir, Game-Show, History, Horror, Musical, Music, Mystery, News, Reality-TV, Romance, Sci-Fi, Short, Sport, Talk-Show, Thriller, War, Western.

    class Film{
        constructor({id, titulo, director, anoestreno, pais, generos, calificacion}){
            this.id = id;
            this.titulo = titulo;
            this.director = director;
            this.anoestreno = anoestreno;
            this.pais = pais;
            this.generos = generos;
            this.calificacion = calificacion;

            const generosAceptados = ['Action', 'Adult', 'Adventure', 'Animation', 'Biography', 'Comedy', 'Crime', 'Documentary' ,'Drama', 'Family', 'Fantasy', 'Film Noir', 'Game-Show', 'History', 'Horror', 'Musical', 'Music', 'Mystery', 'News', 'Reality-TV', 'Romance', 'Sci-Fi', 'Short', 'Sport', 'Talk-Show', 'Thriller', 'War', 'Western'];

            if (id===undefined) return console.warn("Ha de indicarse un id");
            if (titulo===undefined) return console.warn("Ha de indicarse un titulo");
            if (director===undefined) return console.warn("Ha de indicarse un director");
            if (anoestreno===undefined) return console.warn("Ha de indicarse un año de estreno");
            if (pais===undefined) return console.warn("Ha de indicarse un pais");
            if (generos===undefined) return console.warn("Ha de indicarse un género");
            if (calificacion===undefined) return console.warn("Ha de indicarse una calificación");

            if (!/[A-Za-z]{2}[0-9]{7}/.test(id)) return console.warn("El ID han de ser 2 letras + 7 números");
            if (titulo.length>100) return console.warn("El título ha de ser de 100 caracteres máximo");
            if (titulo.length>50) return console.warn("El director ha de ser de 50 caracteres máximo");
            if (!/[0-9]{4}/.test(anoestreno)) return console.warn("El año de estreno han de ser 4 cifras");
            if (!pais instanceof Array) return console.warn("El pais o paises ha de indicarse mediante un arreglo");
            if (!generos instanceof Array) return console.warn("El género o géneros ha de indicarse mediante un arreglo");
            // if (generos.foreach(elem => )) return console.warn(`El listado de géneros admitidos es el siguiente: ${generosAceptados}`);
            if (!/(\d{1})+(\.\d{2})?|\.\d{2}/.test(calificacion)) return console.warn("Ha de indicarse una calificación de 0 a 10 con un decimal");

     
            generos.forEach(
                element => {
                    if (generosAceptados.indexOf(element)===-1) {
                        console.warn(`Género "${element}" desconocido`);
                        return;
                    }
           
                }
            )
      
        }

        get getGeneros(){
            return this.generos;
        }

        get getFichaTecnica(){

            let fichaTecnica = `Id : ${this.id}\n`;
            fichaTecnica += `Título : ${this.titulo}\n`;
            fichaTecnica += `Director : ${this.director}\n`;
            fichaTecnica += `Año estreno : ${this.anoestreno}\n`;
            fichaTecnica += `País : ${this.pais}\n`;
            fichaTecnica += `Géneros : ${this.generos.join(' - ')}\n`;
            fichaTecnica += `Calificación : ${this.calificacion}\n`;

            return fichaTecnica;
        }

        get getPelicula(){
            return {id, titulo, director, anoestreno, pais, generos, calificacion}
        }

    }

    const elPadrino = new Film({
        id:"EP0000001",
        titulo:"El Padrino",
        director:"Scorsese",
        anoestreno:1972,
        pais:["Estados Unidos"],
        generos:["Crime","Drama","Film Noir"],
        calificacion:19.98
    });
    
    // console.log(elPadrino);
    // console.log(elPadrino.getGeneros);
    // console.log(elPadrino.getFichaTecnica);

    const tresPeliculas = [
        {
            id:"EP0000001",
            titulo:"El Padrino",
            director:"Scorsese",
            anoestreno:1972,
            pais:["Estados Unidos"],
            generos:["Crime","Drama","Film Noir"],
            calificacion:9
        },
        {
            id:"EP0000002",
            titulo:"El Padrino II",
            director:"Scorsese",
            anoestreno:1972,
            pais:["Estados Unidos"],
            generos:["Crime","Drama","Film Noir"],
            calificacion:8.9
        },
        {
            id:"EP0000003",
            titulo:"El Padrino III",
            director:"Scorsese",
            anoestreno:1990,
            pais:["Estados Unidos"],
            generos:["Crime","Drama","Film Noir"],
            calificacion:7.8
        }
    ];

    for (const pelicula of tresPeliculas) {
        const instanciaPelicula = new Film(pelicula);
        // console.log(instanciaPelicula.getFichaTecnica) 
    }

    //Respuesta

    class Pelicula {
        constructor({id, titulo, director, anoestreno, pais, generos, calificacion}){
            this.id = id;
            this.titulo = titulo;
            this.director = director;
            this.anoestreno = anoestreno;
            this.pais = pais;
            this.generos = generos;
            this.calificacion = calificacion;

            this.validarIMDB(id);
            this.validarTitulo(titulo);
            this.validarDirector(director);
            this.validarEstreno(anoestreno);
            this.validarPais(pais);
            this.validarGeneros(generos);
            this.validarCalificacion(calificacion);
        }

        static get listaGeneros(){
            return ['Action', 'Adult', 'Adventure', 'Animation', 'Biography', 'Comedy', 'Crime', 'Documentary' ,'Drama', 'Family', 'Fantasy', 'Film Noir', 'Game-Show', 'History', 'Horror', 'Musical', 'Music', 'Mystery', 'News', 'Reality-TV', 'Romance', 'Sci-Fi', 'Short', 'Sport', 'Talk-Show', 'Thriller', 'War', 'Western'];
        }
        static generosAceptados(){
            console.log(`El listado de géneros aceptados es: ${Pelicula.listaGeneros.join(", ")}`);
        }

        validarCadena(propiedad,valor){
            if (!valor) return console.warn(`${propiedad } "${valor}" está vacío`);
            if (typeof valor !== "string") return console.warn(`${propiedad } "${valor}" NO es una cadena de texto`);
            return true;
        }

        validarArreglo(propiedad,valor){
            if (!valor) return console.warn(`${propiedad } "${valor}" está vacío`);
            if (!valor instanceof Array) return console.warn(`${propiedad } "${valor}" NO es un arreglo`);
            for (const cadena of valor) {
                if (typeof cadena !== "string") return console.warn(`El valor ${cadena} ingresado no es una cadena de texto`);
            }
            return true;
        }

        validarLongitudCadena(propiedad,valor,longitud){
            if (valor.length>longitud) return console.error(`${propiedad} "${valor}" excede el número de caracteres permitidos (${longitud})`);
            return true;
        }

        validarNumero(propiedad,valor){
            if (!valor) return console.warn(`${propiedad } "${valor}" está vacío`);
            if (typeof valor !== "number") return console.warn(`${propiedad } "${valor}" NO es una número`);
            return true;
        }

        validarIMDB(id){
            if (this.validarCadena("IMDB Id",id))
                if (!/^([a-z]){2}([0-9]){7}$/.test(id))
                    return console.error(`IMDB Id "${id}" no es válido, debe tener 2 caracteres de texto en minúscula + 7 caracteres numéricos`);
        }

        validarTitulo(titulo){
            if (this.validarCadena("Título",titulo))
                this.validarLongitudCadena("Título",titulo,100);
        }
        
        validarDirector(director){
            if (this.validarCadena("Director",director))
                this.validarLongitudCadena("Director",director,50);
        }

        validarEstreno(anoestreno){
            if (this.validarNumero("Año estreno",anoestreno))
                if (!/^([0-9]){4}$/.test(anoestreno))
                    return console.error(`Año de estreno "${anoestreno}" no es válido, debe ser un número de 4 caracteres`);
        }

        validarPais(pais){
             this.validarArreglo("País",pais);
        }

        validarGeneros(generos){
            if (this.validarArreglo("Géneros",generos)){
                for (const genero of generos) {
                    if (!Pelicula.listaGeneros.includes(genero)){
                        console.error(`El genero ${genero} no se incluye entre los genero disponibles`)
                        Pelicula.generosAceptados();
                    } 
                }
            }            
        }

        validarCalificacion(calificacion){
            if (this.validarNumero("Calñificación",calificacion))
                return (calificacion<0 || calificacion>10)
                    ? console.error('La calificación debe estar entre 0 y 10') 
                    : this.calificacion = calificacion.toFixed(1);
               
        }

        fichaTecnica(){
                console.log(`Ficha Técnica\nTítulo : ${this.titulo}\nDirector : ${this.director}\nAño estreno : ${this.anoestreno}\nPaís : ${this.pais.join(' - ')}\nGéneros : ${this.generos.join(', ')}\nCalificación : ${this.calificacion}\nIMDB Id : ${this.id}\n`);

        }
      

    }

    const peli = new Pelicula({
        id: "tt1234567",
        titulo: "Rocky",
        director: "quiensabe",
        anoestreno: 1920,
        pais: ["México","Francia"],
        generos:  ["Sci-Fi","Comedy"],
        calificacion: 9.34
    });

    peli.fichaTecnica();

    const misPelis = [
        {
            id:"ep0000001",
            titulo:"El Padrino",
            director:"Scorsese",
            anoestreno:1972,
            pais:["Estados Unidos"],
            generos:["Crime","Drama","Film Noir"],
            calificacion:9
        },
        {
            id:"ep0000002",
            titulo:"El Padrino II",
            director:"Scorsese",
            anoestreno:1972,
            pais:["Estados Unidos"],
            generos:["Crime","Drama","Film Noir"],
            calificacion:8.9
        },
        {
            id:"ep0000003",
            titulo:"El Padrino III",
            director:"Scorsese",
            anoestreno:1990,
            pais:["Estados Unidos"],
            generos:["Crime","Drama","Film Noir"],
            calificacion:7.8
        }
    ];

    misPelis.forEach(elem => new Pelicula(elem).fichaTecnica())

    



    </script>
</body>
</html>